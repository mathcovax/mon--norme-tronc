// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
    provider      = "prisma-client-js"
    binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
    provider = "postgresql"
    url      = env("POSTGRES_DATABASE_URL")
}

model user {
    id                 String                 @id @default(uuid())
    email              String                 @unique @db.VarChar(320)
    lastname           String                 @db.VarChar(32)
    firstname          String                 @db.VarChar(36)
    dateOfBirth        DateTime               @db.Date
    address            String                 @db.VarChar(400)
    primordialRole     primordial_role        @default(CUSTOMER)
    organization       organization?
    muted              Boolean                @default(false)
    userToOrganization user_to_organization[]
}

enum primordial_role {
    CUSTOMER
    MODERATOR
    CONTENTS_MASTER
    ADMIN
}

model organization {
    id                  String                 @id @default(uuid())
    name                String                 @unique @db.VarChar(255)
    label               String?                @db.VarChar(36)
    ownerId             String                 @unique
    owner               user                   @relation(fields: [ownerId], references: [id])
    suspended           Boolean                @default(false)
    userToOrganization  user_to_organization[]
    product_sheet       product_sheet[]
    image_product_sheet image_product_sheet[]
    warehouses          warehouse[]
    logoKey             String?                @db.VarChar(255)
    logoUrl             String?                @db.VarChar(400)
    products            product[]
}

model user_to_organization {
    organizationRole organization_role
    userId           String
    user             user              @relation(fields: [userId], references: [id])
    organizationId   String
    organization     organization      @relation(fields: [organizationId], references: [id])

    @@unique([userId, organizationId])
}

enum organization_role {
    STORE_KEEPER
    PRODUCT_SHEET_MANAGER
    ACCOUNTANT
    OWNER
}

model category {
    name             String                        @unique @db.VarChar(255)
    disabled         Boolean                       @default(false)
    imageUrl         String?                       @db.VarChar(400)
    imageKey         String?                       @db.VarChar(255)
    parentCategories category_to_parent_category[]
    productSheets    product_sheet_to_category[]
    navigationItem   navigation_item[]
}

model parent_category {
    name           String                        @unique @db.VarChar(255)
    categories     category_to_parent_category[]
    navigationItem navigation_item[]
}

model category_to_parent_category {
    categoryName       String
    parentCategoryName String
    category           category        @relation(fields: [categoryName], references: [name])
    parentCategory     parent_category @relation(fields: [parentCategoryName], references: [name])

    @@unique([categoryName, parentCategoryName])
}

model product_sheet {
    id               String                      @id @default(uuid())
    name             String                      @db.VarChar(255)
    description      String                      @db.Text
    shortDescription String                      @db.VarChar(255)
    price            Float
    categories       product_sheet_to_category[]
    createdAt        DateTime                    @default(now())
    updatedAt        DateTime                    @updatedAt
    images           image_product_sheet[]
    organization     organization                @relation(fields: [organizationId], references: [id])
    organizationId   String
    products         product[]
    facets           facet[]
    status           product_sheet_status        @default(UNVERIFIED)
}

enum product_sheet_status {
    VERIFIED
    UNVERIFIED
    REMOVE
}

model product_sheet_to_category {
    productSheetId String
    categoryName   String
    productSheet   product_sheet @relation(fields: [productSheetId], references: [id])
    category       category      @relation(fields: [categoryName], references: [name])

    @@unique([categoryName, productSheetId])
}

model image_product_sheet {
    id             String        @id @default(uuid())
    productSheet   product_sheet @relation(fields: [productSheetId], references: [id])
    productSheetId String
    organization   organization  @relation(fields: [organizationId], references: [id])
    organizationId String
    url            String        @db.VarChar(400)
    key            String        @db.VarChar(255)
    alt            String?       @db.VarChar(255)
}

model warehouse {
    id             String       @id @default(uuid())
    name           String       @db.VarChar(255)
    address        String       @db.Text
    organization   organization @relation(fields: [organizationId], references: [id])
    organizationId String
    product        product[]
}

model navigation_item {
    id                 String               @id @default(uuid())
    type               navigation_item_type
    priority           Int
    parentCategoryName String?
    parentCategory     parent_category?     @relation(fields: [parentCategoryName], references: [name])
    categoryName       String?
    category           category?            @relation(fields: [categoryName], references: [name])
    url                String?              @db.VarChar(400)
    title              String?              @unique @db.VarChar(30)
}

enum navigation_item_type {
    PARENT_CATEGORY
    CATEGORY
    LINK
}

model product {
    sku            String         @unique @db.VarChar(255)
    productSheet   product_sheet  @relation(fields: [productSheetId], references: [id])
    productSheetId String
    organization   organization   @relation(fields: [organizationId], references: [id])
    organizationId String
    status         product_status @default(IN_STOCK)
    warehouseId    String
    warehouse      warehouse      @relation(fields: [warehouseId], references: [id])
    createdAt      DateTime       @default(now())
    updatedAt      DateTime       @updatedAt
}

enum product_status {
    ORDER
    WRONG
    SOLD
    IN_STOCK
}

model facet {
    type           facet_type
    productSheet   product_sheet @relation(fields: [productSheetId], references: [id])
    productSheetId String
    value          String        @db.VarChar(50)

    @@unique([type, productSheetId])
}

enum facet_type {
    COLOR
    SIZE
    DIAMETER
    TARGET
    ACCESSORY
    MATERIAL
    STIMULATION
}
